- content_for(:title) { "Nouveau RDV Collectif" }

= render "admin/rdv_wizard_steps/card", rdv_wizard_form: @rdv_wizard, next_steps: [{step: 2}, {step: 3}, {step: 4}], step_title: t("admin.rdv_wizard_steps.step1.step_title") do
  = simple_form_for(@rdv_wizard, as: :rdv, url: admin_organisation_rdv_wizard_step_path(current_organisation), method: :get) do |f|
    = render "model_errors", model: @rdv_wizard
    = render "admin/rdv_wizard_steps/hidden_fields", f: f, step: 1, \
      fields: %i[starts_at lieu_id context service_id], \
      user_ids: @rdv.user_ids, agent_ids: @rdv.agent_ids
    = f.input :service_id, \
      collection: @services.ordered_by_name, \
      input_html: { \
        class: "select2-input js-service-filter", \
        data: { \
          placeholder: "Sélectionnez un service pour filtrer les motifs", \
          "select-options": { disableSearch: true } \
        } \
      }
    = f.input :motif_id, \
      required: true, \
      include_blank: true, \
      collection: @motifs.includes(:service).to_a.group_by { _1.service.name }, \
      as: :grouped_select, \
      group_method: :last,
      label_method: -> { motif_name_with_location_type(_1) }, \
      input_html: { \
        data: { placeholder: "Sélectionnez un motif" },
        class: "js-filtered-motifs" \
      }

    .row.align-items-center.mt-3
      .col.text-left
        = link_to "Revenir en arrière", admin_organisation_rdvs_collectifs_path(current_organisation), class: "btn btn-outline-primary"
      .col.text-right
        = f.button :submit, "Continuer"
