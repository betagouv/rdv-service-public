{
  "openapi": "3.0.1",
  "info": {
    "title": "API RDV Service Public pour Visioplainte",
    "version": "v1",
    "description": "# Authentification\n\nL'authentification à l'api se fait en passant la clé d'api dans le header `X-VISIOPLAINTE-API-KEY`.\n\nPar exemple:\n```\ncurl --request GET --url \"https://demo.rdv.anct.gouv.fr/api/visioplainte/creneaux\" --header \"X-VISIOPLAINTE-API-KEY: LA_CLE_D_API\"\n```\n"
  },
  "paths": {
    "/api/visioplainte/creneaux": {
      "get": {
        "summary": "Lister les créneaux disponibles",
        "security": [
          {
            "X-VISIOPLAINTE-API-KEY": [

            ]
          }
        ],
        "parameters": [
          {
            "name": "X-VISIOPLAINTE-API-KEY",
            "in": "header",
            "description": "Clé d'API",
            "example": "visioplainte-api-test-key-123456",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "service",
            "in": "query",
            "description": "Indique si on souhaite obtenir les créneaux de la plateforme de la gendarmerie ou de la police. Les deux valeurs possibles sont donc 'Police' ou 'Gendarmerie'",
            "example": "Police",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "date_debut",
            "in": "query",
            "description": "date au format iso8601 (YYYY-MM-DD), premier jour de la liste de créneaux qu’on renverra",
            "example": "2024-12-22",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "date_fin",
            "in": "query",
            "description": "date au format iso8601 (YYYY-MM-DD), dernier jour de la liste de créneaux qu’on renverra (inclus dans les résultats)",
            "example": "2024-12-28",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "tags": [
          "Créneaux"
        ],
        "description": "Renvoie les créneaux disponibles",
        "responses": {
          "200": {
            "description": "Renvoie les créneaux",
            "content": {
              "application/json": {
                "examples": {
                  "example": {
                    "value": {
                      "creneaux": [
                        {
                          "starts_at": "2024-08-19T08:00:00+02:00",
                          "duration_in_min": 30
                        },
                        {
                          "starts_at": "2024-08-19T08:30:00+02:00",
                          "duration_in_min": 30
                        },
                        {
                          "starts_at": "2024-08-19T09:00:00+02:00",
                          "duration_in_min": 30
                        },
                        {
                          "starts_at": "2024-08-19T09:30:00+02:00",
                          "duration_in_min": 30
                        },
                        {
                          "starts_at": "2024-08-19T10:00:00+02:00",
                          "duration_in_min": 30
                        },
                        {
                          "starts_at": "2024-08-19T10:30:00+02:00",
                          "duration_in_min": 30
                        },
                        {
                          "starts_at": "2024-08-19T11:00:00+02:00",
                          "duration_in_min": 30
                        },
                        {
                          "starts_at": "2024-08-19T11:30:00+02:00",
                          "duration_in_min": 30
                        },
                        {
                          "starts_at": "2024-08-20T08:00:00+02:00",
                          "duration_in_min": 30
                        },
                        {
                          "starts_at": "2024-08-20T08:30:00+02:00",
                          "duration_in_min": 30
                        },
                        {
                          "starts_at": "2024-08-20T09:00:00+02:00",
                          "duration_in_min": 30
                        },
                        {
                          "starts_at": "2024-08-20T09:30:00+02:00",
                          "duration_in_min": 30
                        },
                        {
                          "starts_at": "2024-08-20T10:00:00+02:00",
                          "duration_in_min": 30
                        },
                        {
                          "starts_at": "2024-08-20T10:30:00+02:00",
                          "duration_in_min": 30
                        },
                        {
                          "starts_at": "2024-08-20T11:00:00+02:00",
                          "duration_in_min": 30
                        },
                        {
                          "starts_at": "2024-08-20T11:30:00+02:00",
                          "duration_in_min": 30
                        },
                        {
                          "starts_at": "2024-08-22T08:00:00+02:00",
                          "duration_in_min": 30
                        },
                        {
                          "starts_at": "2024-08-22T08:30:00+02:00",
                          "duration_in_min": 30
                        },
                        {
                          "starts_at": "2024-08-22T09:00:00+02:00",
                          "duration_in_min": 30
                        },
                        {
                          "starts_at": "2024-08-22T09:30:00+02:00",
                          "duration_in_min": 30
                        },
                        {
                          "starts_at": "2024-08-22T10:00:00+02:00",
                          "duration_in_min": 30
                        },
                        {
                          "starts_at": "2024-08-22T10:30:00+02:00",
                          "duration_in_min": 30
                        },
                        {
                          "starts_at": "2024-08-22T11:00:00+02:00",
                          "duration_in_min": 30
                        },
                        {
                          "starts_at": "2024-08-22T11:30:00+02:00",
                          "duration_in_min": 30
                        },
                        {
                          "starts_at": "2024-08-23T08:00:00+02:00",
                          "duration_in_min": 30
                        },
                        {
                          "starts_at": "2024-08-23T08:30:00+02:00",
                          "duration_in_min": 30
                        },
                        {
                          "starts_at": "2024-08-23T09:00:00+02:00",
                          "duration_in_min": 30
                        },
                        {
                          "starts_at": "2024-08-23T09:30:00+02:00",
                          "duration_in_min": 30
                        },
                        {
                          "starts_at": "2024-08-23T10:00:00+02:00",
                          "duration_in_min": 30
                        },
                        {
                          "starts_at": "2024-08-23T10:30:00+02:00",
                          "duration_in_min": 30
                        },
                        {
                          "starts_at": "2024-08-23T11:00:00+02:00",
                          "duration_in_min": 30
                        },
                        {
                          "starts_at": "2024-08-23T11:30:00+02:00",
                          "duration_in_min": 30
                        }
                      ]
                    }
                  }
                },
                "schema": {
                  "type": "object",
                  "properties": {
                    "creneaux": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "starts_at": {
                            "type": "string"
                          },
                          "duration_in_min": {
                            "type": "integer"
                          }
                        }
                      }
                    }
                  },
                  "required": [
                    "creneaux"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/visioplainte/creneaux/prochain": {
      "get": {
        "summary": "Indique la date du prochain créneau",
        "security": [
          {
            "X-VISIOPLAINTE-API-KEY": [

            ]
          }
        ],
        "parameters": [
          {
            "name": "X-VISIOPLAINTE-API-KEY",
            "in": "header",
            "description": "Clé d'API",
            "example": "visioplainte-api-test-key-123456",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "service",
            "in": "query",
            "description": "Indique si on souhaite obtenir les créneaux de la plateforme de la gendarmerie ou de la police. Les deux valeurs possibles sont donc 'Police' ou 'Gendarmerie'",
            "example": "Police",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "date_debut",
            "in": "query",
            "description": "date au format iso8601 (YYYY-MM-DD), date à partir de laquelle on cherche des créneaux",
            "example": "2024-12-22",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "tags": [
          "Créneaux"
        ],
        "description": "Renvoie le prochain créneau disponible",
        "responses": {
          "200": {
            "description": "Renvoie le prochain créneau disponible",
            "content": {
              "application/json": {
                "examples": {
                  "example": {
                    "value": {
                      "starts_at": "2024-08-19T08:00:00+02:00",
                      "duration_in_min": 30
                    }
                  }
                },
                "schema": {
                  "type": "object",
                  "properties": {
                    "starts_at": {
                      "type": "string"
                    },
                    "duration_in_min": {
                      "type": "integer"
                    }
                  },
                  "required": [
                    "starts_at",
                    "duration_in_min"
                  ]
                }
              }
            }
          },
          "404": {
            "description": "Renvoie un message d'erreur si aucun créneau n'est disponible",
            "content": {
              "application/json": {
                "examples": {
                  "example": {
                    "value": {
                      "errors": [
                        "Aucun créneau n'est disponible après cette date pour ce service."
                      ]
                    }
                  }
                },
                "schema": {
                  "type": "object",
                  "properties": {
                    "errors": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    }
                  },
                  "required": [
                    "errors"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/visioplainte/guichets": {
      "get": {
        "summary": "Les guichets représentent des postes physiques. Il est possible d'ouvrir une plage d'ouverture pour un guichet. Un rdv est associé à un guichet",
        "security": [
          {
            "X-VISIOPLAINTE-API-KEY": [

            ]
          }
        ],
        "parameters": [
          {
            "name": "X-VISIOPLAINTE-API-KEY",
            "in": "header",
            "description": "Clé d'API",
            "example": "visioplainte-api-test-key-123456",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "tags": [
          "Guichets"
        ],
        "responses": {
          "200": {
            "description": "Renvoie la liste des guichets",
            "content": {
              "application/json": {
                "examples": {
                  "example": {
                    "value": {
                      "guichets": [
                        {
                          "id": 158,
                          "name": "GUICHET 1"
                        },
                        {
                          "id": 159,
                          "name": "GUICHET 2"
                        }
                      ]
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/visioplainte/plages_ouverture": {
      "get": {
        "summary": "Ces plages d'ouvertures sont les horaires sur lesquels un guichet est ouvert, et permettent de savoir à quels guichets affecter des agents.        Cet enpoint permet d'obtenir la liste des occurrences pour une période donnée (une plage d'ouverture récurrente ayant plusieurs occurrences).        Cet endpoint ne prend pas encore en compte les absences.",
        "security": [
          {
            "X-VISIOPLAINTE-API-KEY": [

            ]
          }
        ],
        "parameters": [
          {
            "name": "X-VISIOPLAINTE-API-KEY",
            "in": "header",
            "description": "Clé d'API",
            "example": "visioplainte-api-test-key-123456",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "date_debut",
            "in": "query",
            "description": "date au format iso8601 (YYYY-MM-DD), premier jour de la liste qu’on renverra",
            "example": "2024-12-22",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "date_fin",
            "in": "query",
            "description": "date au format iso8601 (YYYY-MM-DD), dernier jour de la liste qu’on renverra (inclus dans les résultats)",
            "example": "2024-12-28",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "guichet_ids[]",
            "in": "query",
            "description": "Une liste d'ids des guichets sur lesquels on veut filtrer les plages d'ouverture",
            "required": false,
            "schema": {
              "type": "array"
            }
          }
        ],
        "tags": [
          "Plages d'ouverture"
        ],
        "responses": {
          "200": {
            "description": "Renvoie la liste des plages d'ouverture",
            "content": {
              "application/json": {
                "examples": {
                  "example": {
                    "value": {
                      "plages_ouverture": [

                      ]
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/visioplainte/rdvs": {
      "get": {
        "summary": "Lister les rdvs",
        "security": [
          {
            "X-VISIOPLAINTE-API-KEY": [

            ]
          }
        ],
        "parameters": [
          {
            "name": "X-VISIOPLAINTE-API-KEY",
            "in": "header",
            "description": "Clé d'API",
            "example": "visioplainte-api-test-key-123456",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "date_debut",
            "in": "query",
            "description": "datetime au format iso8601. Obligatoire sauf si le paramètre ids est utilisé.                Permet de filtrer pour obtenir uniquement les rendez-vous qui commencent à partir de cette heure",
            "example": "2024-08-19T08:00:00+02:00",
            "required": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "date_fin",
            "in": "query",
            "description": "datetime au format iso8601.  Obligatoire sauf si le paramètre ids est utilisé.                Permet de filtrer pour obtenir uniquement les rendez-vous qui commencent avant cette heure",
            "example": "2024-08-22T19:00:00+02:00",
            "required": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "ids[]",
            "in": "query",
            "description": "Une liste d'ids des rendez-vous qu'on souhaite obtenir",
            "required": false,
            "schema": {
              "type": "array"
            }
          },
          {
            "name": "guichet_ids[]",
            "in": "query",
            "description": "Une liste d'ids des guichets sur lesquels on veut filtrer les rendez-vous.",
            "required": false,
            "schema": {
              "type": "array"
            }
          }
        ],
        "tags": [
          "Rendez-vous"
        ],
        "description": "Liste tous les rendez-vous, et permet de filtrer par date, par guichet, ou sur des rdv spécifiques",
        "responses": {
          "200": {
            "description": "Renvoie la liste",
            "content": {
              "application/json": {
                "examples": {
                  "example": {
                    "value": {
                      "rdvs": [

                      ]
                    }
                  }
                }
              }
            }
          }
        }
      },
      "post": {
        "summary": "Prendre un rdv",
        "security": [
          {
            "X-VISIOPLAINTE-API-KEY": [

            ]
          }
        ],
        "parameters": [
          {
            "name": "X-VISIOPLAINTE-API-KEY",
            "in": "header",
            "description": "Clé d'API",
            "example": "visioplainte-api-test-key-123456",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "service",
            "in": "query",
            "description": "Indique si on souhaite prendre rendez-vous avec la gendarmerie ou la police. Les deux valeurs possibles sont donc 'Police' ou 'Gendarmerie'",
            "example": "Police",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "starts_at",
            "in": "query",
            "description": "datetime au format iso8601. Normalement c'est une des valeurs proposées par l'endpoint de liste des créneaux.",
            "example": "2024-08-19T08:00:00+02:00",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "tags": [
          "Rendez-vous"
        ],
        "description": "Crée un rdv et réserve le créneau correspondant.",
        "responses": {
          "201": {
            "description": "Prend le rdv",
            "content": {
              "application/json": {
                "examples": {
                  "example": {
                    "value": {
                      "id": 14,
                      "created_at": "2024-08-18 14:00:00 +0200",
                      "duration_in_min": 30,
                      "ends_at": "2024-08-19 08:30:00 +0200",
                      "guichet": {
                        "id": 172,
                        "name": "GUICHET 1"
                      },
                      "starts_at": "2024-08-19 08:00:00 +0200",
                      "status": "unknown",
                      "user_id": 15
                    }
                  }
                },
                "schema": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "integer"
                    },
                    "created_at": {
                      "type": "string"
                    },
                    "starts_at": {
                      "type": "string"
                    },
                    "duration_in_min": {
                      "type": "integer"
                    },
                    "ends_at": {
                      "type": "string"
                    },
                    "guichet": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "integer"
                        },
                        "name": {
                          "type": "string"
                        }
                      }
                    },
                    "user_id": {
                      "type": "integer"
                    }
                  },
                  "required": [
                    "id",
                    "created_at",
                    "duration_in_min",
                    "ends_at",
                    "guichet",
                    "starts_at",
                    "status",
                    "user_id"
                  ]
                }
              }
            }
          },
          "422": {
            "description": "Si le créneau n'est pas disponible",
            "content": {
              "application/json": {
                "examples": {
                  "example": {
                    "value": {
                      "errors": [
                        "Pas de créneau disponible pour ce service à la date demandée"
                      ]
                    }
                  }
                },
                "schema": {
                  "type": "object",
                  "properties": {
                    "errors": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    }
                  },
                  "required": [
                    "errors"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/visioplainte/rdvs/{id}": {
      "delete": {
        "summary": "Supprimer un rdv",
        "security": [
          {
            "X-VISIOPLAINTE-API-KEY": [

            ]
          }
        ],
        "parameters": [
          {
            "name": "X-VISIOPLAINTE-API-KEY",
            "in": "header",
            "description": "Clé d'API",
            "example": "visioplainte-api-test-key-123456",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "tags": [
          "Rendez-vous"
        ],
        "description": "Supprime le rdv. Il n'apparaîtra plus dans aucune requête de l'api",
        "responses": {
          "204": {
            "description": "Supprime le rdv",
            "content": {
              "application/json": {
                "examples": {
                  "example": {
                    "value": ""
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/visioplainte/rdvs/{id}/cancel": {
      "put": {
        "summary": "Annuler un rdv",
        "security": [
          {
            "X-VISIOPLAINTE-API-KEY": [

            ]
          }
        ],
        "parameters": [
          {
            "name": "X-VISIOPLAINTE-API-KEY",
            "in": "header",
            "description": "Clé d'API",
            "example": "visioplainte-api-test-key-123456",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "tags": [
          "Rendez-vous"
        ],
        "description": "Annule le rdv. Il apparaîtra encore dans la liste des rdv du guichet.",
        "responses": {
          "200": {
            "description": "Annule le rdv",
            "content": {
              "application/json": {
                "examples": {
                  "example": {
                    "value": {
                      "id": 16,
                      "created_at": "2024-08-18 14:00:00 +0200",
                      "duration_in_min": 30,
                      "ends_at": "2024-08-19 08:30:00 +0200",
                      "guichet": {
                        "id": 187,
                        "name": "GUICHET 1"
                      },
                      "starts_at": "2024-08-19 08:00:00 +0200",
                      "status": "excused",
                      "user_id": 17
                    }
                  }
                },
                "schema": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "integer"
                    },
                    "created_at": {
                      "type": "string"
                    },
                    "starts_at": {
                      "type": "string"
                    },
                    "duration_in_min": {
                      "type": "integer"
                    },
                    "ends_at": {
                      "type": "string"
                    },
                    "guichet": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "integer"
                        },
                        "name": {
                          "type": "string"
                        }
                      }
                    },
                    "user_id": {
                      "type": "integer"
                    }
                  },
                  "required": [
                    "id",
                    "created_at",
                    "duration_in_min",
                    "ends_at",
                    "guichet",
                    "starts_at",
                    "status",
                    "user_id"
                  ]
                }
              }
            }
          }
        }
      }
    }
  }
}